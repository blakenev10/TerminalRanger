#!/bin/bash

# Search for build directories
if [ "$1" == "--all" ]; then
    echo "Searching for all build directories (cmake-build-* and cmake-testbuild-*)"
    BUILD_DIRS=$(find "$(pwd)" -type d \( -name 'cmake-build-*' -o -name 'cmake-testbuild-*' \))
else
    echo "Searching for build directories (cmake-build-*)"
    BUILD_DIRS=$(find "$(pwd)" -type d -name 'cmake-build-*')
fi

# Check if any build directories were found
if [ -z "${BUILD_DIRS}" ]; then
    echo "No CMake build directories found to build"
    exit 1
else
    echo "Building CMake builds:"
    for DIR in ${BUILD_DIRS}; do
        echo "  ${DIR}"
    done
fi

# Iterate over each build directory and run the install command
for DIR in ${BUILD_DIRS}; do
    sudo cmake --build "${DIR}" --verbose
done
